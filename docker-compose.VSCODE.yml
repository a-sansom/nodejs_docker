version: "3"
services:
  deleteme:
    # Define configuration for building the deleteme 'service' container.
    build:
      context: .
      dockerfile: Dockerfile
    # This works with 'build' to create image, if not existing, to build new image from 'build' config.
    # If 'build' is not present, will try and pull an image with the specified name.
    # See https://docs.docker.com/compose/compose-file/#image 
    #
    # Using the tag ':vscode' here becuase we're using the 'command: sleep infinity' further down to be able to run from VScode and debug (with or without nodemon).
    # See ./devcontainer.json
    image: alexsansom/deleteme:vscode
    # Specifying a container_name stops ability to use more than one of a contianer at a time as each container needs to have unique name.
    #container_name: deleteme
    # Map host (the Mac) port to port that's EXPOSEd in the Dockerfile.
    ports:
      - 3000:3000
    # Mount a host (the Mac) filesystem path to a container path (which is used, for this example, as the WORKDIR in the Dockerfile).
    # This is being defined at this 'service' level, but can be defined at top level, for use across other services.
    volumes:
      - .:/app
    # Adding this overrides the default CMD. Building the image with this means we can use VSCode to debug in the container.
    # We have to configure 'nodemon' as part of the debugger config in launch.json.
    # This 'command' and the ':vscode' tag should be the only differences between docker-compose.yml and docker-compose.VSCODE.yml
    command: sleep infinity
